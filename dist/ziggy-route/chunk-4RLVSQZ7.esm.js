function p(a){return Array.isArray(a)}var I=a=>typeof a=="number"&&!Number.isNaN(a),l=a=>typeof a=="string";var O=(a,e)=>{if(!l(a))return!0;c(e)||(e={});let{trim:t=!0}=e;return t&&(a=a.trim()),a===""};var A=a=>typeof a=="boolean";var k=a=>a instanceof Error;function c(a){return typeof a=="object"&&!g(a)&&!p(a)}var R=a=>a===null,m=a=>typeof a>"u";function b(a){return typeof a=="object"&&!g(a)}var U=Function.prototype.toString;function g(a){return a==null}var C=()=>typeof window>"u"||typeof document>"u";import{stringify as D}from"qs";var S={PACKAGE:{NPM_NAME:"@rzl-zone/ziggy-route",PACKAGIST_NAME:"rzl-zone/ziggy-route",PREFIX:{NAME:"RZL ZIGGY"}},REPO:{LINK:"https://github.com/rzl-zone/ziggy-route"}};import{parse as L}from"qs";var s=class extends Error{constructor(t,o,r){let n=r?.trim()||S.PACKAGE.PREFIX.NAME,i=t.trim();super(`${n} - ${i}`);this.originalError=o;this.name="RouterConfigError",Error.captureStackTrace&&Error.captureStackTrace(this,u)}},u=class a extends Error{constructor(t,o,r){let n=r?.trim()||S.PACKAGE.PREFIX.NAME,i=t.trim();super(`${n} - ${i}`);this.originalError=o;this.name="RoutePropsError",Error.captureStackTrace&&Error.captureStackTrace(this,a)}};var d=class{name;definition;config;wheres;bindings={};constructor(e,t,o){this.name=e,this.definition=t,this.bindings=t?.bindings??{},this.wheres=t?.wheres??{},this.config=o}get template(){let e=`${this.origin}/${this.definition?.uri}`.replace(/\/+$/,"");return O(e)?"/":e}get origin(){if(!this.config?.absolute)return"";if(this.definition?.domain){let e=this.config.url.match(/^\w+:\/\//);if(!e)throw new s("Invalid `config.url` missing protocol (e.g., http:// or https://)");return`${e[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`}return this.config.url}get parameterSegments(){return this.template.match(/{[^}?]+\??}/g)?.map(e=>({name:e.replace(/{|\??}/g,""),required:!/\?}$/.test(e)}))??[]}matchesUrl(e){if(!this.definition?.methods.includes("GET"))return!1;let t=this.template.replace(/[.*+$()[\]]/g,"\\$&").replace(/(\/?){([^}?]*)(\??)}/g,(i,f,y,x)=>{let w=`(?<${y}>${this.wheres[y]?.replace(/(^\^)|(\$$)/g,"")||"[^/?]+"})`;return x?`(${f}${w})?`:`${f}${w}`}).replace(/^\w+:\/\//,""),[o,r]=e.replace(/^\w+:\/\//,"").split("?"),n=new RegExp(`^${t}/?$`).exec(o)??new RegExp(`^${t}/?$`).exec(decodeURI(o));if(n){for(let i in n.groups)n.groups[i]=l(n.groups[i])?decodeURIComponent(n.groups[i]):n.groups[i];return{params:n.groups,query:L(r)}}return!1}compile(e={}){let t=this.template.replace(/{([^}?]+)(\??)}/g,(r,n,i)=>{let f=e[n];if(!i&&g(f))throw new u(`Invalid \`${n}\` parameter is required for route \`${this.name}\`.`);if(this.wheres[n]){let y=new RegExp(`^${this.wheres[n]}$`);if(l(f)&&!y.test(f))throw new u(`Invalid \`${n}\` parameter \`${f}\` does not match required format \`${this.wheres[n]}\` for route \`${this.name}\`.`)}return encodeURI(l(f)?f:"").replace(/%7C/g,"|").replace(/%25/g,"%").replace(/\$/g,"%24")}),o=t;if(this.config?.absolute&&t.includes("://")){let[r,n]=t.split("://");o=r+"://"+n.replace(/\/{2,}/g,"/")}else o=t.replace(/\/{2,}/g,"/");return o==="/"?"/":o.replace(/\/+$/,"")}};var $=class a{absolute;url;port;defaults;routes;location;constructor(e){this.absolute=e.absolute,this.url=e.url,this.port=e.port,this.defaults=e.defaults,this.routes=e.routes,this.location=e.location}static isRouterConfigRaw(e){if(g(e))return!1;let t=e;if(!c(t))throw new s(`Invalid \`route()\` \`config\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid config object, \`config\` need object type but you passing as \`${typeof t}\`.`);if(!l(t.url))throw new s(`Invalid \`route()\` \`config.url\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.url\`, \`config.url\` need string or null type but you passing as \`${typeof t.url}\`.`);if(!R(t.port)&&!I(t.port))throw new s(`Invalid \`route()\` \`config.port\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.port\`, \`config.port\` need number or null type but you passing as \`${typeof t.port}\`.`);if(!b(t.defaults))throw new s(`Invalid \`route()\` \`config.defaults\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.defaults\`, \`config.defaults\` need array or object type but you passing as \`${typeof t.defaults}\`.`);if(!c(t.routes))throw new s(`Invalid \`route()\` \`config.routes\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.routes\`, \`config.routes\` need object type but you passing as \`${p(t.routes)?"Array":typeof t.routes}\`.`);if("location"in t){let o=t.location;if(l(o))throw new s(`Invalid \`route()\` \`config.location\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid config object, \`config.location\` need object type\`{ host?: string | undefined; pathname?: string | undefined ;search?: string | undefined; }\` but you passing as \`${typeof o}\`.`);if(!c(o))throw new s(`Invalid \`route()\` \`config.location\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.location\`, \`config.location\` need object type but you passing as \`${p(o)?"Array":typeof o}\`.`);let r=o;if("host"in r&&!l(r.host)&&!m(r.host))throw new s(`Invalid \`route()\` \`config.location.host\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.location.host\`, \`config.location.host\` need string or undefined type but you passing as \`${typeof r.host}\`.`);if("pathname"in r&&!l(r.pathname)&&!m(r.pathname))throw new s(`Invalid \`route()\` \`config.location.pathname\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.location.pathname\`, \`config.location.pathname\` need string or undefined type but you passing as \`${typeof r.pathname}\`.`);if("search"in r&&!l(r.search)&&!m(r.search))throw new s(`Invalid \`route()\` \`config.location.search\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.location.search\`, \`config.location.search\` need string or undefined type but you passing as \`${typeof r.search}\`.`)}return!0}static validateAndWrap(e){try{if(e instanceof a)return e;if(!this.isRouterConfigRaw(e))throw new s("Invalid `route()` config properties detected. Ensure that `appRoutes` is defined globally or passed as a valid config object.");return new a(e)}catch(t){throw t instanceof s?t:new s("Invalid `route()` config properties detected. Ensure that `appRoutes` is defined globally or passed as a valid config object.",k(t)?t:new Error(String(t)))}}};var{REPO:h,PACKAGE:z}=S,T=class extends String{_config;_route;_params={};constructor(e,t,o=!1,r){if(super(),O(e))throw new u(`Invalid \`route()\` "name" value it cannot be an empty string. Use \`undefined\` if you don't want to provide a name. Make sure to call a valid \`Router\` instance method, or you'll encounter an error. Learn more: ${h.LINK}#%EF%B8%8F-warning-calling-route-without-arguments.`);if(!R(o)&&!A(o))throw new u(`Invalid \`route()\` option "absolute" must be a boolean or undefined, but received type "${typeof o}". Learn more: ${h.LINK}#absolute-url.`);o=!!o;let n=this.safeValidateRouterConfig(r||(m(appRoutes)?globalThis.appRoutes:appRoutes));if(this._config={...n,absolute:o},e){if(!this._config.routes[e])throw new u(`Route name '${e}' is not in the route list.`);this._route=new d(e,this._config.routes[e],this._config),this._params=this._parse(t)}}safeValidateRouterConfig(e){try{return $.validateAndWrap(e)}catch(t){throw t instanceof s?t:new Error(`${z.PREFIX.NAME} - Unknown error while validating \`route()\` config`,{cause:t instanceof Error?t:void 0})}}_unresolve(e){e?this._config.absolute&&e.startsWith("/")&&(e=this._location().host+e):e=this._currentUrl();let t={},[o,r]=Object.entries(this._config.routes).find(([n,i])=>t=new d(n,i,this._config).matchesUrl(e))||[void 0,void 0];return{name:o,...t,route:r}}_currentUrl(){let{host:e,pathname:t,search:o}=this._location();return(this._config.absolute?e+t:t.replace(this._config.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+o}_location(){let{host:e="",pathname:t="",search:o=""}=C()?{}:window.location;return{host:this._config.location?.host??e,pathname:this._config.location?.pathname??t,search:this._config.location?.search??o}}_parse(e={},t=this._route){if(!b(e))throw new u(`Invalid \`route()\` \`params\` property detected. Value \`params\` need object or array type but you passing as \`${typeof e}\`. More info \u2192 ${h.LINK}#parameters`);e??={},e=["string","number"].includes(typeof e)?[e]:e;let o=t?.parameterSegments.filter(({name:r})=>!this._config.defaults[r]);return p(e)?e=e.reduce((r,n,i)=>o?.[i]?{...r,[o[i].name]:n}:b(n)?{...r,...n}:{...r,...l(n)?{[n]:""}:{}},{}):o?.length===1&&!e[o?.[0].name]&&(t&&e.hasOwnProperty(Object.values(t.bindings)[0])||e.hasOwnProperty("id"))&&(e={[o?.[0].name]:e}),{...this._defaults(t),...this._substituteBindings(e,t)}}_defaults(e){return e?.parameterSegments.filter(({name:t})=>this._config.defaults[t]).reduce((t,{name:o},r)=>({...t,[o]:this._config.defaults[o]}),{})}_substituteBindings(e,t=this._route){return Object.entries(e).reduce((o,[r,n])=>{if(!n||typeof n!="object"||p(n)||!t?.parameterSegments.some(({name:i})=>i===r))return{...o,[r]:n};if(!n.hasOwnProperty(t.bindings[r]))if(n.hasOwnProperty("id"))t.bindings[r]="id";else throw new u(`Object passed as '${r}' parameter is missing route model binding key '${t.bindings[r]}'. More info \u2192 ${h.LINK}#parameters`);return{...o,[r]:n[t.bindings[r]]}},{})}get params(){let{params:e,query:t}=this._unresolve(),o={};for(let r in t){let n=t[r];l(n)?o[r]=n:p(n)?o[r]=n.filter(l).join(","):n&&c(n)&&(o[r]=JSON.stringify(n))}return{...e,...o}}get routeParams(){return this._unresolve().params||{}}get queryParams(){return this._unresolve().query||{}}has(e){if(!l(e))throw new u(`Invalid \`route().has(...)\` the \`name\` parameter must be a string, but received \`${typeof e}\`.`);return this._config.routes.hasOwnProperty(e)}current(e,t={}){if(e&&!l(e))throw new u(`Invalid \`route().current(...)\` \`name\` property detected. Value \`name\` need string type but you passing as \`${typeof e}\`.`);if(t&&!b(t))throw new u(`Invalid \`params\` value passed to \`route().current(...)\`, expected a object or array (e.g., { foo: "bar" } or [{"foo": "bar"}]), but received \`${typeof t}\`. Learn more: ${h.LINK}#routecurrent-optionally-accepts-parameters-as-its-second-argument-and-will-check-that-their-values-also-match-in-the-current-url.`);t??={};let{name:o,params:r,query:n,route:i}=this._unresolve();if(!e)return o;let f=l(o)&&new RegExp(`^${e.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(o);if(g(t)||!f)return f;let y=new d(o,i,this._config);t=this._parse(t,y);let x={...r,...n};if(Object.values(t).every(v=>!v)&&!Object.values(x).some(v=>!m(v)))return!0;let w=(v,E)=>Object.entries(v).every(([N,j])=>{if(p(j)&&p(E[N])){let P=E[N];return j.every(M=>P.includes(M))}return c(j)&&c(E[N])?w(j,E[N]):E[N]==j});return w(t,x)}toString(){let e=this._route,t=this._params??={};if(!e)throw new u(`Function route() was called without a name but used as a string. Pass a valid route name, or use route().current() to get the current route name \u2014 or route().current('dashboard') to check if it matches. More info \u2192 ${h.LINK}#%EF%B8%8F-warning-calling-route-without-arguments`);let o=Object.keys(t).filter(n=>!e.parameterSegments.some(({name:i})=>i===n)).filter(n=>n!=="_query").reduce((n,i)=>({...n,[i]:t[i]}),{}),r=t._query;if(!m(r)&&(!c(r)||R(r)||p(r)))throw new u(`Invalid \`params._query\` value passed to \`route()\`, expected a plain object (e.g., { foo: "bar" }), but received \`${typeof r}\`. More info \u2192 ${h.LINK}#query-parameters`);return e.compile(t)+D({...o,...r},{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(n,i)=>A(n)?String(+n):i(n)})}valueOf(){return this.toString()}};function ae(a,e,t=!1,o){let r=new T(a,e,t,o);return a?r.toString():r}export{m as a,s as b,ae as c};

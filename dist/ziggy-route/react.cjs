"use strict";var A=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var V=(a,e)=>{for(var t in e)A(a,t,{get:e[t],enumerable:!0})},B=(a,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of F(e))!q.call(a,r)&&r!==t&&A(a,r,{get:()=>e[r],enumerable:!(n=_(e,r))||n.enumerable});return a};var K=a=>B(A({},"__esModule",{value:!0}),a);var Y={};V(Y,{useRoute:()=>G});module.exports=K(Y);function p(a){return Array.isArray(a)}var k=a=>typeof a=="number"&&!Number.isNaN(a),l=a=>typeof a=="string";var T=(a,e)=>{if(!l(a))return!0;c(e)||(e={});let{trim:t=!0}=e;return t&&(a=a.trim()),a===""};var I=a=>typeof a=="boolean";var P=a=>a instanceof Error;function c(a){return typeof a=="object"&&!g(a)&&!p(a)}var j=a=>a===null,m=a=>typeof a>"u";function b(a){return typeof a=="object"&&!g(a)}var J=Function.prototype.toString;function g(a){return a==null}var C=()=>typeof window>"u"||typeof document>"u";var L=require("qs");var S={PACKAGE:{NPM_NAME:"@rzl-zone/ziggy-route",PACKAGIST_NAME:"rzl-zone/ziggy-route",PREFIX:{NAME:"RZL ZIGGY"}},REPO:{LINK:"https://github.com/rzl-zone/ziggy-route"}};var M=require("qs");var s=class extends Error{constructor(t,n,r){let o=r?.trim()||S.PACKAGE.PREFIX.NAME,i=t.trim();super(`${o} - ${i}`);this.originalError=n;this.name="RouterConfigError",Error.captureStackTrace&&Error.captureStackTrace(this,u)}},u=class a extends Error{constructor(t,n,r){let o=r?.trim()||S.PACKAGE.PREFIX.NAME,i=t.trim();super(`${o} - ${i}`);this.originalError=n;this.name="RoutePropsError",Error.captureStackTrace&&Error.captureStackTrace(this,a)}};var d=class{name;definition;config;wheres;bindings={};constructor(e,t,n){this.name=e,this.definition=t,this.bindings=t?.bindings??{},this.wheres=t?.wheres??{},this.config=n}get template(){let e=`${this.origin}/${this.definition?.uri}`.replace(/\/+$/,"");return T(e)?"/":e}get origin(){if(!this.config?.absolute)return"";if(this.definition?.domain){let e=this.config.url.match(/^\w+:\/\//);if(!e)throw new s("Invalid `config.url` missing protocol (e.g., http:// or https://)");return`${e[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`}return this.config.url}get parameterSegments(){return this.template.match(/{[^}?]+\??}/g)?.map(e=>({name:e.replace(/{|\??}/g,""),required:!/\?}$/.test(e)}))??[]}matchesUrl(e){if(!this.definition?.methods.includes("GET"))return!1;let t=this.template.replace(/[.*+$()[\]]/g,"\\$&").replace(/(\/?){([^}?]*)(\??)}/g,(i,f,y,x)=>{let w=`(?<${y}>${this.wheres[y]?.replace(/(^\^)|(\$$)/g,"")||"[^/?]+"})`;return x?`(${f}${w})?`:`${f}${w}`}).replace(/^\w+:\/\//,""),[n,r]=e.replace(/^\w+:\/\//,"").split("?"),o=new RegExp(`^${t}/?$`).exec(n)??new RegExp(`^${t}/?$`).exec(decodeURI(n));if(o){for(let i in o.groups)o.groups[i]=l(o.groups[i])?decodeURIComponent(o.groups[i]):o.groups[i];return{params:o.groups,query:(0,M.parse)(r)}}return!1}compile(e={}){let t=this.template.replace(/{([^}?]+)(\??)}/g,(r,o,i)=>{let f=e[o];if(!i&&g(f))throw new u(`Invalid \`${o}\` parameter is required for route \`${this.name}\`.`);if(this.wheres[o]){let y=new RegExp(`^${this.wheres[o]}$`);if(l(f)&&!y.test(f))throw new u(`Invalid \`${o}\` parameter \`${f}\` does not match required format \`${this.wheres[o]}\` for route \`${this.name}\`.`)}return encodeURI(l(f)?f:"").replace(/%7C/g,"|").replace(/%25/g,"%").replace(/\$/g,"%24")}),n=t;if(this.config?.absolute&&t.includes("://")){let[r,o]=t.split("://");n=r+"://"+o.replace(/\/{2,}/g,"/")}else n=t.replace(/\/{2,}/g,"/");return n==="/"?"/":n.replace(/\/+$/,"")}};var O=class a{absolute;url;port;defaults;routes;location;constructor(e){this.absolute=e.absolute,this.url=e.url,this.port=e.port,this.defaults=e.defaults,this.routes=e.routes,this.location=e.location}static isRouterConfigRaw(e){if(g(e))return!1;let t=e;if(!c(t))throw new s(`Invalid \`route()\` \`config\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid config object, \`config\` need object type but you passing as \`${typeof t}\`.`);if(!l(t.url))throw new s(`Invalid \`route()\` \`config.url\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.url\`, \`config.url\` need string or null type but you passing as \`${typeof t.url}\`.`);if(!j(t.port)&&!k(t.port))throw new s(`Invalid \`route()\` \`config.port\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.port\`, \`config.port\` need number or null type but you passing as \`${typeof t.port}\`.`);if(!b(t.defaults))throw new s(`Invalid \`route()\` \`config.defaults\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.defaults\`, \`config.defaults\` need array or object type but you passing as \`${typeof t.defaults}\`.`);if(!c(t.routes))throw new s(`Invalid \`route()\` \`config.routes\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.routes\`, \`config.routes\` need object type but you passing as \`${p(t.routes)?"Array":typeof t.routes}\`.`);if("location"in t){let n=t.location;if(l(n))throw new s(`Invalid \`route()\` \`config.location\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid config object, \`config.location\` need object type\`{ host?: string | undefined; pathname?: string | undefined ;search?: string | undefined; }\` but you passing as \`${typeof n}\`.`);if(!c(n))throw new s(`Invalid \`route()\` \`config.location\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.location\`, \`config.location\` need object type but you passing as \`${p(n)?"Array":typeof n}\`.`);let r=n;if("host"in r&&!l(r.host)&&!m(r.host))throw new s(`Invalid \`route()\` \`config.location.host\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.location.host\`, \`config.location.host\` need string or undefined type but you passing as \`${typeof r.host}\`.`);if("pathname"in r&&!l(r.pathname)&&!m(r.pathname))throw new s(`Invalid \`route()\` \`config.location.pathname\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.location.pathname\`, \`config.location.pathname\` need string or undefined type but you passing as \`${typeof r.pathname}\`.`);if("search"in r&&!l(r.search)&&!m(r.search))throw new s(`Invalid \`route()\` \`config.location.search\` properties detected. Ensure that \`appRoutes\` is defined globally or passed as a valid \`config.location.search\`, \`config.location.search\` need string or undefined type but you passing as \`${typeof r.search}\`.`)}return!0}static validateAndWrap(e){try{if(e instanceof a)return e;if(!this.isRouterConfigRaw(e))throw new s("Invalid `route()` config properties detected. Ensure that `appRoutes` is defined globally or passed as a valid config object.");return new a(e)}catch(t){throw t instanceof s?t:new s("Invalid `route()` config properties detected. Ensure that `appRoutes` is defined globally or passed as a valid config object.",P(t)?t:new Error(String(t)))}}};var{REPO:h,PACKAGE:W}=S,$=class extends String{_config;_route;_params={};constructor(e,t,n=!1,r){if(super(),T(e))throw new u(`Invalid \`route()\` "name" value it cannot be an empty string. Use \`undefined\` if you don't want to provide a name. Make sure to call a valid \`Router\` instance method, or you'll encounter an error. Learn more: ${h.LINK}#%EF%B8%8F-warning-calling-route-without-arguments.`);if(!j(n)&&!I(n))throw new u(`Invalid \`route()\` option "absolute" must be a boolean or undefined, but received type "${typeof n}". Learn more: ${h.LINK}#absolute-url.`);n=!!n;let o=this.safeValidateRouterConfig(r||(m(appRoutes)?globalThis.appRoutes:appRoutes));if(this._config={...o,absolute:n},e){if(!this._config.routes[e])throw new u(`Route name '${e}' is not in the route list.`);this._route=new d(e,this._config.routes[e],this._config),this._params=this._parse(t)}}safeValidateRouterConfig(e){try{return O.validateAndWrap(e)}catch(t){throw t instanceof s?t:new Error(`${W.PREFIX.NAME} - Unknown error while validating \`route()\` config`,{cause:t instanceof Error?t:void 0})}}_unresolve(e){e?this._config.absolute&&e.startsWith("/")&&(e=this._location().host+e):e=this._currentUrl();let t={},[n,r]=Object.entries(this._config.routes).find(([o,i])=>t=new d(o,i,this._config).matchesUrl(e))||[void 0,void 0];return{name:n,...t,route:r}}_currentUrl(){let{host:e,pathname:t,search:n}=this._location();return(this._config.absolute?e+t:t.replace(this._config.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+n}_location(){let{host:e="",pathname:t="",search:n=""}=C()?{}:window.location;return{host:this._config.location?.host??e,pathname:this._config.location?.pathname??t,search:this._config.location?.search??n}}_parse(e={},t=this._route){if(!b(e))throw new u(`Invalid \`route()\` \`params\` property detected. Value \`params\` need object or array type but you passing as \`${typeof e}\`. More info \u2192 ${h.LINK}#parameters`);e??={},e=["string","number"].includes(typeof e)?[e]:e;let n=t?.parameterSegments.filter(({name:r})=>!this._config.defaults[r]);return p(e)?e=e.reduce((r,o,i)=>n?.[i]?{...r,[n[i].name]:o}:b(o)?{...r,...o}:{...r,...l(o)?{[o]:""}:{}},{}):n?.length===1&&!e[n?.[0].name]&&(t&&e.hasOwnProperty(Object.values(t.bindings)[0])||e.hasOwnProperty("id"))&&(e={[n?.[0].name]:e}),{...this._defaults(t),...this._substituteBindings(e,t)}}_defaults(e){return e?.parameterSegments.filter(({name:t})=>this._config.defaults[t]).reduce((t,{name:n},r)=>({...t,[n]:this._config.defaults[n]}),{})}_substituteBindings(e,t=this._route){return Object.entries(e).reduce((n,[r,o])=>{if(!o||typeof o!="object"||p(o)||!t?.parameterSegments.some(({name:i})=>i===r))return{...n,[r]:o};if(!o.hasOwnProperty(t.bindings[r]))if(o.hasOwnProperty("id"))t.bindings[r]="id";else throw new u(`Object passed as '${r}' parameter is missing route model binding key '${t.bindings[r]}'. More info \u2192 ${h.LINK}#parameters`);return{...n,[r]:o[t.bindings[r]]}},{})}get params(){let{params:e,query:t}=this._unresolve(),n={};for(let r in t){let o=t[r];l(o)?n[r]=o:p(o)?n[r]=o.filter(l).join(","):o&&c(o)&&(n[r]=JSON.stringify(o))}return{...e,...n}}get routeParams(){return this._unresolve().params||{}}get queryParams(){return this._unresolve().query||{}}has(e){if(!l(e))throw new u(`Invalid \`route().has(...)\` the \`name\` parameter must be a string, but received \`${typeof e}\`.`);return this._config.routes.hasOwnProperty(e)}current(e,t={}){if(e&&!l(e))throw new u(`Invalid \`route().current(...)\` \`name\` property detected. Value \`name\` need string type but you passing as \`${typeof e}\`.`);if(t&&!b(t))throw new u(`Invalid \`params\` value passed to \`route().current(...)\`, expected a object or array (e.g., { foo: "bar" } or [{"foo": "bar"}]), but received \`${typeof t}\`. Learn more: ${h.LINK}#routecurrent-optionally-accepts-parameters-as-its-second-argument-and-will-check-that-their-values-also-match-in-the-current-url.`);t??={};let{name:n,params:r,query:o,route:i}=this._unresolve();if(!e)return n;let f=l(n)&&new RegExp(`^${e.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(n);if(g(t)||!f)return f;let y=new d(n,i,this._config);t=this._parse(t,y);let x={...r,...o};if(Object.values(t).every(v=>!v)&&!Object.values(x).some(v=>!m(v)))return!0;let w=(v,E)=>Object.entries(v).every(([R,N])=>{if(p(N)&&p(E[R])){let z=E[R];return N.every(U=>z.includes(U))}return c(N)&&c(E[R])?w(N,E[R]):E[R]==N});return w(t,x)}toString(){let e=this._route,t=this._params??={};if(!e)throw new u(`Function route() was called without a name but used as a string. Pass a valid route name, or use route().current() to get the current route name \u2014 or route().current('dashboard') to check if it matches. More info \u2192 ${h.LINK}#%EF%B8%8F-warning-calling-route-without-arguments`);let n=Object.keys(t).filter(o=>!e.parameterSegments.some(({name:i})=>i===o)).filter(o=>o!=="_query").reduce((o,i)=>({...o,[i]:t[i]}),{}),r=t._query;if(!m(r)&&(!c(r)||j(r)||p(r)))throw new u(`Invalid \`params._query\` value passed to \`route()\`, expected a plain object (e.g., { foo: "bar" }), but received \`${typeof r}\`. More info \u2192 ${h.LINK}#query-parameters`);return e.compile(t)+(0,L.stringify)({...n,...r},{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(o,i)=>I(o)?String(+o):i(o)})}valueOf(){return this.toString()}};function D(a,e,t=!1,n){let r=new $(a,e,t,n);return a?r.toString():r}function G(a){if(!a&&!globalThis.appRoutes&&m(appRoutes))throw new s("Hook `useRouter()` missing configuration. Ensure that a `appRoutes` variable is defined globally or pass a config object into the `useRoute` hook.");return(e,t,n)=>D(e,t,n,a)}0&&(module.exports={useRoute});
